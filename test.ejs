<%= convertTimeStampToDate(recordData.created_at) %>


<%
function convertTimeStampToDate(date){
   date = Number(date)
      var d = new Date(date),
         month = '' + (d.getMonth() + 1),
         day = '' + d.getDate(),
         year = d.getFullYear();

   if (month.length < 2)
   month = '0' + month;
   if (day.length < 2)
   day = '0' + day;
   var date = new Date();
   date.toLocaleDateString();

   return [day, month, year].join('-');
}
%>



<td><video width="80" height="60" controls>
   <source src="/uploads/shortvideo/<%= shortVideo.video %>" type="video/mp4"></video></td>


   filename: function (req, file, cb) {
      var fileExt = file.originalname.split(".").pop();
      cb(null, `${Date.now()}.${fileExt}`);
    },


<!-- sjdgxkzjvjkxf -->
<%- include ('partials/header.ejs') %>
<div class="page-wrapper">
    <!-- ====== -->
    <!-- Bread crumb and right sidebar toggle -->
    <!-- ====== -->
    <div class="page-breadcrumb">
       <div class="row">
          <div class="col-5 align-self-center">
             <h4 class="page-title">Notifications</h4>
             <div class="d-flex align-items-center">
                <nav aria-label="breadcrumb">
                   <ol class="breadcrumb">
                      <li class="breadcrumb-item"><a href="#">Home</a></li>
                      <li class="breadcrumb-item active" aria-current="page">Notifications</li>
                   </ol>
                </nav>
             </div>
          </div>
       </div>
    </div>
    <!-- ====== -->
    <!-- End Bread crumb and right sidebar toggle -->
    <!-- ====== -->
    <!-- ====== -->
    <!-- Container fluid  -->
    <!-- ====== -->
    <div class="container-fluid">
       <!-- ====== -->
       <!-- Start Page Content -->
       <!-- ====== -->
       <button class="btn btn-success animated pulse" data-toggle="modal" data-target="#modalAddNew">Add New Notification</button>
       <br><br>
       <!-- The Modal Add New User -->
       <div class="modal animated bounce" id="modalAddNew">
          <div class="modal-dialog modal-dialog-centered modal-xl">
             <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                   <h4 class="modal-title">Add New Notification</h4>
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                   <!-- Row -->
                   <div class="row">
                      <!-- Column -->
                      <div class="col-lg-12 col-xlg-12 col-md-12">
                         <div class="card">
                            <!-- Tabs -->
                            <ul class="nav nav-pills custom-pills" id="pills-tab" role="tablist">
                               <li class="nav-item">
                                  <a class="nav-link active" id="pills-setting-tab" data-toggle="pill" href="#addvehicle" role="tab" aria-controls="pills-setting" aria-selected="true">Add New Notification</a>
                               </li>
                            </ul>
                            <!-- Tabs -->
                            <div class="tab-content" id="pills-tabContent">
                               <div class="tab-pane fade show active" id="addvehicle" role="tabpanel" aria-labelledby="pills-setting-tab">
                                  <div class="card-body">
                                     <form class="form-horizontal form-material" id="submitForm" >
                                        <div class="form-group">
                                           <div class="row">
                                              <div class="col-md-6">
                                                <input type="hidden" name="role" id="role" value = "user"/>
                                                 <label>Title</label>
                                                 <input type="text" name="title" placeholder="Title" class="form-control form-control-line" required>
                                              </div>
                                              <div class="col-md-6">
                                                 <label>Url</label>
                                                 <input type="text" name="url" placeholder="URL" class="form-control form-control-line" required>
                                              </div>
                                           </div>
                                        </div>
                                        <div class="form-group">
                                           <div class="row">
                                              <div class="col-md-6">
                                                 <label>Send Option</label>
                                                 <select name="selectedOption" class="form-control" id="selectedOption">
                                                   <option value="now">Send Now</option>
                                                   <option value="schedule">Schedule</option>
                                                 </select>
                                              </div>
                                              <div class="col-md-6" style="display: none;" id="timeDiv">
                                                 <label>Time</label>
                                                 <input type="time" name="time" placeholder="Time" class="form-control form-control-line">
                                              </div>
                                           </div>
                                        </div>
                                        <div class="form-group">
                                           <div class="row">
                                              <div class="col-md-12">
                                                 <label>Description</label>
                                                 <textarea class="form-control form-control-line" id="description" name="description" placeholder="Description" ></textarea>
                                              </div>
                                           </div>
                                        </div>
                                        <div class="form-group">
                                           <div class="row">
                                              <div class="col-md-6">
                                                 <label>Image</label>
                                                 <input type="file" name="image" placeholder="Image" accept="image/*" class="form-control form-control-line">
                                              </div>
                                           </div>
                                        </div>
                                        <div class="form-group">
                                           <div class="col-sm-12">
                                              <input type="submit" name="submitaddnewuser" class="btn btn-success" value="Submit">
                                           </div>
                                        </div>
                                     </form>
                                  </div>
                               </div>
                            </div>
                         </div>
                      </div>
                      <!-- Column -->
                   </div>
                </div>
                <!--End Modal Body -->
                <!-- Modal footer -->
                <div class="modal-footer">
                   <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
             </div>
          </div>
       </div>
       <!-- Close Add New User -->
       <!-- Row -->
       <div class="row">
          <!-- Column -->
          <div class="col-lg-12 col-xlg-12 col-md-12">
             <div class="card">
                <!-- Tabs -->
                <ul class="nav nav-pills custom-pills" id="pills-tab" role="tablist">
                   <li class="nav-item">
                      <a class="nav-link active" id="pills-timeline-tab" data-toggle="pill" href="#userslist" role="tab" aria-controls="pills-timeline" aria-selected="true">Notifications</a>
                   </li>
                </ul>
                <!-- Tabs -->
                <div class="tab-content" id="pills-tabContent">
                   <div class="tab-pane fade show active" id="userslist" role="tabpanel" aria-labelledby="pills-timeline-tab">
                      <div class="card-body">
                         <div class="table-responsive">
                            <table class="table">
                               <thead class="bg-inverse text-white">
                                  <tr>
                                     <th>Title</th>
                                     <th>Url</th>
                                     <th>Send Type</th>
                                     <th>Send Time</th>
                                     <th>Image</th>
                                     <th>Created</th>
                                  </tr>
                               </thead>
                               <tbody>
                                 <% if(!records[0]) { %>
                                 <tr>
                                     <td colspan="100%">No Data</td>
                                 </tr>
                                 <% } else {%> <% records.forEach(function(record){ %>
                                 <tr>
                                     <td><%= record.title %></td>
                                     <td><%= record.url %></td>
                                     <td><%= record.selectedOption %></td>
                                     <td><%= record.time %></td>
                                     <td>
                                       <% if(record.image) { %>
                                       <img  alt="file" src="/dist/notifications/<%= record.image %>" width="80px" height="80px"/>
                                       <% } %>
                                    </td>
                                     <td><%= convertTimeStampToDate(record.created_at) %></td>
                                 </tr>
                                 <% }); %> <% } %>
                              </tbody>
                            </table>
                         </div>
                      </div>
                   </div>
                </div>
             </div>
          </div>
       </div>
    </div>
 </div>
 <%
function convertTimeStampToDate(date){
   date = Number(date)
      var d = new Date(date),
         month = '' + (d.getMonth() + 1),
         day = '' + d.getDate(),
         year = d.getFullYear();

   if (month.length < 2)
   month = '0' + month;
   if (day.length < 2)
   day = '0' + day;
   var date = new Date();
   date.toLocaleDateString();

   return [day, month, year].join('-');
}
%>
 <%- include ('partials/footer.ejs') %>
 <script>
  $('#selectedOption').on('change',function(e){
      if($(this).val() == 'schedule'){
         $('#timeDiv').css('display','block')
      }else{
         $('#timeDiv').css('display','none')
      }
   })
   var addform = $("#submitForm");
   addform.on("submit", submitFormHandler);

   function submitFormHandler(e) {
      e.preventDefault();
      if ($("#title").val() == "") {
            renderToast({message:"Title is required",icon:'error'})
            return false;
      }
      if ($("#description").val() == "") {
            renderToast({message:"Description is required",icon:'error'})
            return false;
      }
     

     // PREPARE FORM DATA
     var formData = new FormData(addform[0]);

     // DO POST
     $.ajax({
       type: "POST",
       cache: false,
       enctype: "multipart/form-data",
       processData: false,
       contentType: false,
       url: "/admin/notification/add",
       data: formData,
     })
       .done((res) => {
          console.log(res);
          if(res.error == true){
            renderToast({message:res.message,icon:'error'})
          }else{
            renderToast({message:res.message,icon:'success'})
            setTimeout(()=>{
               window.location.href = "/admin/notification/list";
            },2000)
          }
          
       })
       .fail(function (xhr, status, error) {
         console.log("failed");
         console.log(xhr);
         console.log(status);
         console.log(error);
         
       });
   }
 </script>
